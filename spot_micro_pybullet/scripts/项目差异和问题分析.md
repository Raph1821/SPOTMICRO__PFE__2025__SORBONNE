# Spot Mini Mini vs SPOTMICRO 项目差异和问题分析

## 项目位置确认

- **spot_mini_mini**: `src/spot_mini_mini/`
- **SPOTMICRO**: `src/SPOTMICRO__PFE__2025__SORBONNE__SACLAY/`

## SPOTMICRO PyBullet 问题分析

### 问题 1: ROS 依赖
**现状**: `spot_micro_pybullet_sim.py` 是一个 ROS 节点，必须：
- 运行 `roscore`
- 需要其他节点发送 `/servos_proportional` 话题
- 无法独立运行

**解决方案**: 创建独立的 `env_tester.py`（已完成）

### 问题 2: URDF 路径问题
**现状**: URDF 文件使用 `package://` 路径：
```xml
<mesh filename="package://spot_micro_pybullet/urdf/stl/mainbody.stl" .../>
```
PyBullet 无法直接解析 `package://` 路径。

**解决方案**: 
- 在 `env_tester.py` 中添加了 `resolve_urdf_paths()` 函数
- 自动将 `package://` 转换为绝对路径
- 创建临时 URDF 文件供 PyBullet 使用

### 问题 3: 缺少 GUI 控制
**现状**: 原脚本只能被动接收 ROS 话题，没有交互式 GUI。

**解决方案**: 
- 创建了 `SpotMicroGUI` 类
- 提供参数滑块（位置、姿态、步态参数）
- 键盘控制相机视角

## 主要差异总结

### spot_mini_mini
- ✅ **独立仿真环境**: `env_tester.py` 可直接运行
- ✅ **Bezier 曲线步态**: 12 点 Bezier 曲线
- ✅ **完整运动学**: Python 实现的运动学库
- ✅ **GUI 控制**: 右侧参数滑块

### SPOTMICRO（原版）
- ❌ **ROS 节点**: 必须通过 ROS 运行
- ❌ **8 相步态**: 在 C++ 中实现，需要 ROS 节点
- ❌ **无 GUI**: 只能通过 ROS 话题控制
- ❌ **URDF 路径**: 使用 `package://`，非 ROS 环境无法解析

### SPOTMICRO（新创建的 env_tester.py）
- ✅ **独立运行**: 不依赖 ROS
- ✅ **GUI 控制**: 参数滑块和键盘控制
- ✅ **URDF 解析**: 自动处理 `package://` 路径
- ⚠️ **步态生成**: 需要进一步实现（当前是框架）

## 如何使用

### 运行新的 env_tester.py

```bash
cd src/SPOTMICRO__PFE__2025__SORBONNE__SACLAY/spot_micro_pybullet/scripts
python3 env_tester.py
```

### 命令行参数

```bash
python3 env_tester.py [选项]

选项:
  -hf, --HeightField    使用高度场地形
  -r, --DebugRack        将机器人放在架子上（用于调试步态）
  -p, --DebugPath        绘制足端路径（待实现）
  --urdf PATH           指定 URDF 文件路径
```

### GUI 控制

**右侧参数滑块：**
- `x, y, z`: 身体位置
- `roll, pitch, yaw`: 身体姿态
- `Step Length`: 步长
- `Yaw Rate`: 偏航速率
- `Lateral Fraction`: 横向分数
- `Step Velocity`: 步速
- `Clearance Height`: 抬腿高度
- `Penetration Depth`: 穿透深度

**键盘控制：**
- `A/D`: 左右旋转相机
- `C/F`: 上下俯仰相机
- `Z/X`: 缩放相机
- `ESC`: 退出程序

## 待完成的功能

1. **完整的逆运动学计算**
   - 当前只是框架
   - 需要实现完整的运动学计算
   - 参考: `spot_micro_motion_cmd/libs/spot_micro_kinematics_cpp/`

2. **8 相步态生成器**
   - 实现相位管理
   - 实现足端轨迹生成
   - 适配 SPOTMICRO 的 8 相步态

3. **关节角度应用**
   - 正确映射关节名称
   - 应用计算出的关节角度

## 故障排除

### URDF 加载失败

**错误**: `加载机器人失败: ...`

**可能原因**:
1. STL 文件路径不正确
2. STL 文件不存在
3. `package://` 路径解析失败

**解决方法**:
- 检查 `urdf/stl/` 目录下是否有所有 STL 文件
- 检查 URDF 文件中的路径是否正确
- 使用 `--urdf` 参数指定正确的 URDF 路径

### 关节映射问题

**问题**: 关节角度没有应用

**解决方法**:
- 检查 URDF 中的关节名称
- 确保关节名称与代码中的映射匹配
- 查看控制台输出的关节信息

## 参考资源

- **spot_mini_mini 原版**: `src/spot_mini_mini/spot_bullet/src/env_tester.py`
- **SPOTMICRO 运动学配置**: `src/SPOTMICRO__PFE__2025__SORBONNE__SACLAY/spot_micro_motion_cmd/config/spot_micro_motion_cmd.yaml`
- **SPOTMICRO C++ 运动学**: `src/SPOTMICRO__PFE__2025__SORBONNE__SACLAY/spot_micro_motion_cmd/libs/spot_micro_kinematics_cpp/`

