# 机器人差异详细说明

## 关键差异总结

我之前的 `env_tester.py` **确实没有充分考虑机器人差异**，现在已经修复。

## 1. 关节命名差异

### spot_mini_mini
```python
MOTOR_NAMES = [
    "motor_front_left_shoulder", "motor_front_left_leg", "foot_motor_front_left",
    "motor_front_right_shoulder", "motor_front_right_leg", "foot_motor_front_right",
    "motor_rear_left_shoulder", "motor_rear_left_leg", "foot_motor_rear_left",
    "motor_rear_right_shoulder", "motor_rear_right_leg", "foot_motor_rear_right"
]
```

### SPOTMICRO
```python
joint_names = {
    'RF': ['front_right_shoulder', 'front_right_leg', 'front_right_foot'],
    'RB': ['rear_right_shoulder', 'rear_right_leg', 'rear_right_foot'],
    'LB': ['rear_left_shoulder', 'rear_left_leg', 'rear_left_foot'],
    'LF': ['front_left_shoulder', 'front_left_leg', 'front_left_foot']
}
```

**差异**:
- spot_mini_mini 使用 `motor_` 前缀和 `foot_motor_` 前缀
- SPOTMICRO 使用简洁的命名，没有 `motor_` 前缀
- spot_mini_mini 使用 `foot_motor_`，SPOTMICRO 使用 `foot`

## 2. 运动学参数差异

### spot_mini_mini
```python
shoulder_length = 0.04   # 肩关节长度
elbow_length = 0.1       # 肘关节长度
wrist_length = 0.1       # 腕关节长度
hip_x = 0.192           # 髋关节 X 间距
hip_y = 0.085           # 髋关节 Y 间距
foot_x = 0.192          # 足端 X 间距
foot_y = 0.17           # 足端 Y 间距
height = 0.135          # 身体高度
```

### SPOTMICRO
```yaml
hip_link_length: 0.055        # 髋关节连杆长度（水平）
upper_leg_link_length: 0.1075  # 上腿长度
lower_leg_link_length: 0.130   # 下腿长度
body_width: 0.078              # 身体宽度（髋关节间距）
body_length: 0.186             # 身体长度（肩关节间距）
default_stand_height: 0.155     # 默认站立高度
```

**差异**:
- **命名不同**: spot_mini_mini 使用 shoulder/elbow/wrist，SPOTMICRO 使用 hip_link/upper_leg/lower_leg
- **尺寸不同**: 所有参数值都不同
- **结构理解不同**: spot_mini_mini 的模型和 SPOTMICRO 的模型可能有不同的几何结构

## 3. 腿的命名顺序差异

### spot_mini_mini
```python
LEG_POSITION = ["front_left", "front_right", "rear_left", "rear_right"]
# 顺序: FL, FR, BL, BR
```

### SPOTMICRO
```yaml
RF_3: {num: 1, ...}  # Right Front
RB_3: {num: 4, ...}  # Right Back
LB_3: {num: 7, ...}  # Left Back
LF_3: {num: 10, ...} # Left Front
# 顺序: RF, RB, LB, LF
```

**差异**:
- spot_mini_mini: FL, FR, BL, BR
- SPOTMICRO: RF, RB, LB, LF
- 顺序完全不同！

## 4. 运动学模型结构差异

### spot_mini_mini
- 使用 `shoulder_length`, `elbow_length`, `wrist_length`
- 模型可能是：肩关节 → 上臂 → 下臂 → 足端

### SPOTMICRO
- 使用 `hip_link_length`, `upper_leg_link_length`, `lower_leg_link_length`
- 模型是：髋关节 → 水平连杆 → 上腿 → 下腿 → 足端
- **有额外的水平连杆** (`hip_link_length`)

## 5. 步态生成差异

### spot_mini_mini
- **Bezier 曲线**: 12 点控制点生成平滑轨迹
- **连续轨迹**: 可微分的足端轨迹
- Python 实现

### SPOTMICRO
- **8 相步态**: 离散的相位步态
- **4 摆动相 + 4 体移相**: 每次只有一条腿摆动
- C++ 实现（在 ROS 节点中）

## 修复内容

### 1. 创建了 `spot_micro_kinematics.py`
- ✅ 使用 SPOTMICRO 的实际参数（从 yaml 文件）
- ✅ 使用 SPOTMICRO 的关节命名
- ✅ 使用 SPOTMICRO 的腿命名顺序（RF, RB, LB, LF）
- ✅ 实现适配 SPOTMICRO 结构的逆运动学

### 2. 更新了 `env_tester.py`
- ✅ 导入并使用 `SpotMicroKinematics` 类
- ✅ 正确映射 SPOTMICRO 的关节名称
- ✅ 计算并应用关节角度
- ✅ 验证关节映射

## 仍待完成

1. **完整的逆运动学验证**
   - 当前的逆运动学实现是简化版本
   - 需要根据实际的 SPOTMICRO 几何结构验证

2. **8 相步态生成器**
   - 实现相位管理
   - 实现足端轨迹生成
   - 适配 SPOTMICRO 的 8 相步态参数

3. **关节角度限制**
   - 添加关节角度限制检查
   - 防止超出物理限制

## 使用建议

1. **先测试站立姿态**
   - 使用默认参数，确保机器人能正确站立
   - 调整身体高度，观察关节角度变化

2. **验证关节映射**
   - 检查控制台输出的关节映射信息
   - 确保所有关节都正确找到

3. **逐步添加功能**
   - 先实现简单的站立控制
   - 再添加步态生成
   - 最后优化参数

