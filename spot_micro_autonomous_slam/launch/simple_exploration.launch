<?xml version="1.0"?>
<launch>
    <!-- Simple Autonomous Exploration Launch File
    
         This launch file starts a simple exploration system that:
         1. Uses laser scan to detect obstacles
         2. Moves forward when path is clear
         3. Turns when obstacle detected
         4. Explores unknown areas in the map
         
         Arguments:
         - use_pybullet: Use PyBullet simulation (default: false for real robot)
         - rviz: Launch RViz visualization (default: true)
         - enabled: Start exploration automatically (default: false)
    -->
    
    <!-- Arguments -->
    <arg name="use_pybullet" default="false"/>
    <arg name="rviz" default="true"/>
    <arg name="enabled" default="false"/>
    <arg name="rviz_config" default="$(find spot_micro_rviz)/rviz/spot_micro_slam.rviz"/>
    
    <!-- ====== PyBullet Simulation (Optional) ====== -->
    <group if="$(arg use_pybullet)">
        <include file="$(find spot_micro_pybullet)/launch/pybullet_simulation.launch">
            <arg name="use_gui" value="true"/>
            <arg name="rviz" value="false"/>  <!-- We launch rviz separately -->
            <arg name="slam" value="true"/>
            <arg name="obstacles" value="true"/>
        </include>
    </group>
    
    <!-- ====== Real Robot (Default) ====== -->
    <group unless="$(arg use_pybullet)">
        <!-- SLAM Mapping with Motion Control and Lidar (Hector SLAM) -->
        <include file="$(find spot_micro_launch)/launch/motion_control_and_hector_slam.launch">
            <arg name="run_post_proc" value="false"/>
        </include>
    </group>
    
    <!-- ====== Simple Explorer Node ====== -->
    <node name="simple_explorer" pkg="spot_micro_autonomous_slam" type="simple_explorer.py" output="screen">
        <param name="enabled" value="$(arg enabled)"/>
        <param name="max_forward_speed" value="0.25"/>  <!-- m/s -->
        <param name="max_turn_speed" value="0.3"/>      <!-- rad/s -->
        <param name="obstacle_distance" value="0.45"/>   <!-- meters -->
        <param name="safe_distance" value="0.45"/>       <!-- meters -->
        <param name="turn_angle" value="1.57"/>          <!-- 90 degrees in radians -->
    </node>
    
    <!-- ====== RViz Visualization ====== -->
    <group if="$(arg rviz)">
        <node name="rviz" pkg="rviz" type="rviz" args="-d $(arg rviz_config)" output="screen"/>
    </group>

</launch>

